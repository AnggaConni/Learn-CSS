<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Academy - Master Web Design (Preview)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');

        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .bg-checkered {
            background-color: #ffffff;
            background-image: linear-gradient(45deg, #f1f5f9 25%, transparent 25%), linear-gradient(-45deg, #f1f5f9 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f1f5f9 75%), linear-gradient(-45deg, transparent 75%, #f1f5f9 75%);
            background-size: 20px 20px;
        }
        
        /* Animasi untuk modal */
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-animate { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 h-screen overflow-hidden selection:bg-cyan-500 selection:text-white">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // PESAN UNTUK AI (MESSAGE FOR AI)
        // ==========================================
        const MESSAGE_FOR_AI = `
        Hai AI Masa Depan! ðŸ‘‹ (Claude? Gemini v5? GPT-10?)
        
        Status Proyek:
        Saat ini HANYA Level 1-12 yang sudah selesai dan mengikuti constraint ketat.
        Level 13-90 telah DIHAPUS sementara sesuai instruksi user.
        
        Tugas Anda (Jika diminta melengkapi):
        Buat Level 13 sampai 90 dengan pola "Inject & Fix" berikut:
        1. LEVEL GANJIL (Choice): Hanya INJECT kode HTML/CSS baru (biasanya dengan style default/jelek).
        2. LEVEL GENAP (Essay): Hanya MODIFY/FIX properti CSS yang sudah di-inject (tidak menambah selector baru).
        
        Topik yang belum dicover:
        - Advanced Forms (Input styling, Focus states)
        - Positioning (Absolute, Relative, Fixed)
        - CSS Grid Advanced (Areas, Spanning)
        - Responsive Design (Media Queries)
        - Animations (Keyframes, Transitions)
        
        Selamat bekerja! Jangan kecewakan user! ðŸ˜‰
        `;

        // ==========================================
        // CHANGELOG SYSTEM
        // ==========================================
        const CHANGELOG = [
             {
                version: "3.3.0 (Clean Up)",
                date: "2026-02-17",
                changes: [
                    "ðŸ§¹ Menghapus level 13-90 yang belum siap.",
                    "ðŸ“ Menambahkan catatan untuk AI selanjutnya.",
                    "ðŸ Menambahkan Level 13 sebagai Penutup/Playground sementara."
                ]
            },
             {
                version: "3.2.0 (Strict Logic)",
                date: "2026-02-17",
                changes: [
                    "âš™ï¸ Gameplay Constraint: Choice = Add, Essay = Edit.",
                    "ðŸ“š Level 1-12 di-refactor total mengikuti pola 'Inject & Fix'.",
                ]
            },
            {
                version: "3.0.0 (Academy Release)",
                date: "2026-02-16",
                changes: [
                    "âœ¨ Re-branding total menjadi 'CSS Academy'.",
                ]
            }
        ];

        // --- ICONS ---
        const Icon = ({ path, className = "" }) => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>;
        const TerminalIcon = () => <Icon path={<><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></>} />;
        const SaveIcon = () => <Icon path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></>} />;
        const CheckCircleIcon = () => <Icon path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></>} />;
        const PlayIcon = () => <Icon path={<polygon points="5 3 19 12 5 21 5 3"></polygon>} />;
        const GlobeIcon = () => <Icon path={<><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></>} />;
        const FolderOpenIcon = () => <Icon path={<><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></>} />;
        const HelpCircleIcon = () => <Icon path={<><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></>} />;
        const HistoryIcon = () => <Icon path={<><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></>} />;
        const GraduationCapIcon = () => <Icon path={<><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></>} />;

        // --- LEVELS 1-12 (COMPLETED) + LEVEL 13 (PLAYGROUND) ---
        const LEVELS = [
            // ========================================
            // CHAPTER 1: CSS FUNDAMENTALS (1-12)
            // ========================================
            {
                id: 1,
                chapter: 1,
                type: 'choice',
                title: { en: '1. Basic Structure (Inject)', id: '1. Struktur Dasar (Inject)' },
                desc: { en: 'Inject the basic HTML structure and default CSS.', id: 'Masukkan struktur HTML dasar dan CSS bawaan.' },
                targetMarker: '<!-- STEP_1_CONTAINER -->',
                options: [
                    { label: { en: 'A. Table Layout', id: 'A. Table Layout' }, previewCode: '<table>...</table>', code: '...', correct: false, msg: { en: 'Tables are not for layout.', id: 'Table bukan untuk layout.' } },
                    { 
                        label: { en: 'B. Div Container + CSS', id: 'B. Div Container + CSS' }, 
                        previewCode: '.wrapper { ... } h1 { ... }', 
                        code: '<div class="wrapper">\n    <h1>Hello CSS World</h1>\n    <p>Let\'s style this page.</p>\n    \n    <!-- STEP_2_NAV -->\n  </div>', 
                        // INJECTING BAD/DEFAULT CSS FOR LEVEL 2 TO FIX
                        cssToAdd: '\n    /* MAIN LAYOUT */\n    .wrapper { max-width: 800px; margin: 0 auto; padding: 20px; font-family: sans-serif; }\n    \n    /* TYPOGRAPHY (DEFAULT) */\n    h1 {\n      color: red; /* <--- UGLY COLOR */\n      font-weight: 400;\n      letter-spacing: 0px;\n    }',
                        correct: true, 
                        msg: { en: 'Structure injected.', id: 'Struktur ditambahkan.' } 
                    }
                ]
            },
            {
                id: 2,
                chapter: 1,
                type: 'essay',
                title: { en: '2. Fix Typography (Edit)', id: '2. Perbaiki Tipografi (Edit)' },
                desc: { en: 'The headline is red and thin. Edit the existing CSS to make it professional.', id: 'Judul berwarna merah dan tipis. Edit CSS yang ada agar terlihat profesional.' },
                guidance: { 
                    en: [
                        'Find the "h1" selector block.', 
                        'Change color from "red" to "#0f172a".', 
                        'Change font-weight from "400" to "800".',
                        'Change letter-spacing to "-1px".'
                    ], 
                    id: [
                        'Cari blok selector "h1".', 
                        'Ubah color dari "red" menjadi "#0f172a".', 
                        'Ubah font-weight dari "400" menjadi "800".',
                        'Ubah letter-spacing menjadi "-1px".'
                    ] 
                },
                validation: (code) => /color:\s*#0f172a/i.test(code) && /font-weight:\s*800/i.test(code),
                successMsg: { en: 'Typography fixed!', id: 'Tipografi diperbaiki!' }
            },
            {
                id: 3,
                chapter: 1,
                type: 'choice',
                title: { en: '3. Navigation (Inject)', id: '3. Navigasi (Inject)' },
                desc: { en: 'Inject the navigation bar. It will look broken initially.', id: 'Masukkan navigasi bar. Tampilannya akan berantakan awalnya.' },
                targetMarker: '<!-- STEP_2_NAV -->',
                options: [
                    { label: { en: 'A. Float Nav', id: 'A. Float Nav' }, previewCode: 'float: left;', code: '...', correct: false, msg: { en: 'Floats are outdated.', id: 'Float sudah kuno.' } },
                    { 
                        label: { en: 'B. Nav Markup + CSS', id: 'B. Nav Markup + CSS' }, 
                        previewCode: '.nav-bar { display: block; }', 
                        code: '<nav class="nav-bar">\n      <a href="#">Home</a>\n      <a href="#">Learn</a>\n      <a href="#">Style</a>\n    </nav>\n    <!-- STEP_3_HERO -->', 
                        // INJECTING BLOCK DISPLAY (VERTICAL) FOR LEVEL 4 TO FIX
                        cssToAdd: '\n    /* NAVIGATION */\n    .nav-bar { \n      display: block; /* <--- VERTICAL STACK (BAD) */\n      gap: 0px;\n      border-bottom: 2px solid #e2e8f0; \n      padding-bottom: 10px;\n      margin-bottom: 40px;\n    }\n    .nav-bar a { text-decoration: none; color: #64748b; font-weight: 600; margin-right: 10px; }',
                        correct: true, 
                        msg: { en: 'Navigation injected.', id: 'Navigasi ditambahkan.' } 
                    }
                ]
            },
            {
                id: 4,
                chapter: 1,
                type: 'essay',
                title: { en: '4. Activate Flexbox (Edit)', id: '4. Aktifkan Flexbox (Edit)' },
                desc: { en: 'The menu is vertical. Edit .nav-bar to make it horizontal using Flexbox.', id: 'Menu vertikal. Edit .nav-bar agar horizontal menggunakan Flexbox.' },
                guidance: { 
                    en: [
                        'Find ".nav-bar" selector.',
                        'Change display from "block" to "flex".', 
                        'Change gap from "0px" to "20px".'
                    ], 
                    id: [
                        'Cari selector ".nav-bar".',
                        'Ubah display dari "block" menjadi "flex".', 
                        'Ubah gap dari "0px" menjadi "20px".'
                    ] 
                },
                validation: (code) => /display:\s*flex/i.test(code) && /gap:\s*20px/i.test(code),
                successMsg: { en: 'Flexbox active!', id: 'Flexbox aktif!' }
            },
            {
                id: 5,
                chapter: 1,
                type: 'choice',
                title: { en: '5. Hero Section (Inject)', id: '5. Hero Section (Inject)' },
                desc: { en: 'Inject the Hero section. It has no breathing room.', id: 'Masukkan bagian Hero. Belum ada jarak yang lega.' },
                targetMarker: '<!-- STEP_3_HERO -->',
                options: [
                    { label: { en: 'A. Margin Hero', id: 'A. Margin Hero' }, previewCode: 'margin: 50px;', code: '...', correct: false, msg: { en: 'We need internal space.', id: 'Kita butuh ruang dalam.' } },
                    { 
                        label: { en: 'B. Hero Markup + CSS', id: 'B. Hero Markup + CSS' }, 
                        previewCode: 'padding: 0px;', 
                        code: '<div class="hero-box">\n      <h2>CSS is Awesome</h2>\n      <p>Mastering the art of styling.</p>\n    </div>\n    <!-- STEP_4_GRID -->', 
                        // INJECTING BAD PADDING
                        cssToAdd: '\n    /* HERO SECTION */\n    .hero-box { \n      background-color: #f1f5f9; \n      padding: 5px; /* <--- TOO TIGHT */\n      border-radius: 12px; \n      text-align: center;\n    }\n    .hero-box h2 { color: #0f172a; font-size: 2.5rem; }',
                        correct: true, 
                        msg: { en: 'Hero injected.', id: 'Hero ditambahkan.' } 
                    }
                ]
            },
            {
                id: 6,
                chapter: 1,
                type: 'essay',
                title: { en: '6. Fix Box Model (Edit)', id: '6. Perbaiki Box Model (Edit)' },
                desc: { en: 'The hero box is too tight. Increase the internal spacing (padding).', id: 'Kotak hero terlalu sempit. Tambah jarak dalam (padding).' },
                guidance: { 
                    en: ['Find ".hero-box".', 'Change padding from "5px" to "60px".'], 
                    id: ['Cari ".hero-box".', 'Ubah padding dari "5px" menjadi "60px".'] 
                },
                validation: (code) => /padding:\s*60px/i.test(code),
                successMsg: { en: 'Padding fixed!', id: 'Padding diperbaiki!' }
            },
            {
                id: 7,
                chapter: 1,
                type: 'choice',
                title: { en: '7. Grid Layout (Inject)', id: '7. Grid Layout (Inject)' },
                desc: { en: 'Inject the feature cards. They are stacked vertically by default.', id: 'Masukkan kartu fitur. Mereka tertumpuk vertikal secara default.' },
                targetMarker: '<!-- STEP_4_GRID -->',
                options: [
                    { label: { en: 'A. Inline Block', id: 'A. Inline Block' }, previewCode: 'display: inline-block;', code: '...', correct: false, msg: { en: 'Not modern.', id: 'Tidak modern.' } },
                    { 
                        label: { en: 'B. Grid Markup + CSS', id: 'B. Grid Markup + CSS' }, 
                        previewCode: 'display: block;', 
                        code: '<div class="feature-grid">\n      <div class="card">Selectors</div>\n      <div class="card">Box Model</div>\n      <div class="card">Flexbox</div>\n    </div>\n    <!-- STEP_5_FOOTER -->', 
                        // INJECTING BLOCK DISPLAY (STACKED)
                        cssToAdd: '\n    /* GRID LAYOUT */\n    .feature-grid { \n      display: block; /* <--- STACKED (DEFAULT) */\n      gap: 0px;\n      margin-top: 40px; \n    }\n    .card { background: white; padding: 20px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; }',
                        correct: true, 
                        msg: { en: 'Grid markup injected.', id: 'Grid markup ditambahkan.' } 
                    }
                ]
            },
            {
                id: 8,
                chapter: 1,
                type: 'essay',
                title: { en: '8. Activate Grid (Edit)', id: '8. Aktifkan Grid (Edit)' },
                desc: { en: 'Turn the feature list into a 3-column grid.', id: 'Ubah daftar fitur menjadi grid 3 kolom.' },
                guidance: { 
                    en: [
                        'Find ".feature-grid".',
                        'Change display to "grid".', 
                        'Add "grid-template-columns: 1fr 1fr 1fr;".',
                        'Change gap to "20px".'
                    ], 
                    id: [
                        'Cari ".feature-grid".',
                        'Ubah display menjadi "grid".', 
                        'Tambah "grid-template-columns: 1fr 1fr 1fr;".',
                        'Ubah gap menjadi "20px".'
                    ] 
                },
                validation: (code) => /display:\s*grid/i.test(code) && /grid-template-columns:/i.test(code),
                successMsg: { en: 'Grid active!', id: 'Grid aktif!' }
            },
            {
                id: 9,
                chapter: 1,
                type: 'choice',
                title: { en: '9. Footer (Inject)', id: '9. Footer (Inject)' },
                desc: { en: 'Inject the footer. It has a default blue link color.', id: 'Masukkan footer. Warna link-nya biru default.' },
                targetMarker: '<!-- STEP_5_FOOTER -->',
                options: [
                    { label: { en: 'A. Div Footer', id: 'A. Div Footer' }, previewCode: 'div', code: '...', correct: false, msg: { en: 'Use semantic tag.', id: 'Gunakan tag semantik.' } },
                    { 
                        label: { en: 'B. Footer + CSS', id: 'B. Footer + CSS' }, 
                        previewCode: 'background: white;', 
                        code: '<footer class="main-footer">\n      &copy; 2026 CSS Academy.\n    </footer>', 
                        cssToAdd: '\n    /* FOOTER */\n    .main-footer { \n      margin-top: 60px; \n      padding: 30px; \n      text-align: center; \n      border-top: 1px solid #cbd5e1; \n      background-color: #ffffff; /* <--- TOO BRIGHT */\n      color: #64748b;\n    }',
                        correct: true, 
                        msg: { en: 'Footer injected.', id: 'Footer ditambahkan.' } 
                    }
                ]
            },
            {
                id: 10,
                chapter: 1,
                type: 'essay',
                title: { en: '10. Dark Footer (Edit)', id: '10. Footer Gelap (Edit)' },
                desc: { en: 'Invert the footer colors for better contrast.', id: 'Balik warna footer agar kontras lebih baik.' },
                guidance: { 
                    en: [
                        'Find ".main-footer".',
                        'Change background-color to "#1e293b".', 
                        'Change color to "#ffffff".'
                    ], 
                    id: [
                        'Cari ".main-footer".',
                        'Ubah background-color menjadi "#1e293b".', 
                        'Ubah color menjadi "#ffffff".'
                    ] 
                },
                validation: (code) => /background-color:\s*#1e293b/i.test(code) && /color:\s*#ffffff/i.test(code),
                successMsg: { en: 'Footer darkened!', id: 'Footer digelapkan!' }
            },
            {
                id: 11,
                chapter: 1,
                type: 'choice',
                title: { en: '11. Variables (Inject)', id: '11. Variables (Inject)' },
                desc: { en: 'Inject CSS Variables block at the top.', id: 'Masukkan blok CSS Variables di paling atas.' },
                targetMarker: '/* CSS RESET */',
                options: [
                    { label: { en: 'A. SASS Variables', id: 'A. SASS Variables' }, previewCode: '$primary: blue;', code: '...', correct: false, msg: { en: 'We are learning native CSS.', id: 'Kita belajar CSS murni.' } },
                    { 
                        label: { en: 'B. CSS Root Variables', id: 'B. CSS Root Variables' }, 
                        previewCode: ':root { ... }', 
                        code: ':root {\n      --primary: red; /* <--- BAD DEFAULT */\n      --text: #0f172a;\n    }\n    \n    /* CSS RESET */', 
                        // Note: Using a different replacement strategy for :root usually, but here we append before reset
                        // For simplicity in this logic, we rely on string replacement of the marker
                        correct: true, 
                        msg: { en: 'Variables injected.', id: 'Variables ditambahkan.' } 
                    }
                ]
            },
            {
                id: 12,
                chapter: 1,
                type: 'essay',
                title: { en: '12. Fix Variables (Edit)', id: '12. Perbaiki Variables (Edit)' },
                desc: { en: 'The primary variable is red. Change it to our brand blue.', id: 'Variable primary berwarna merah. Ubah ke biru brand kita.' },
                guidance: { 
                    en: [
                        'Find ":root" block at the top.', 
                        'Change --primary from "red" to "#0ea5e9".'
                    ], 
                    id: [
                        'Cari blok ":root" di atas.', 
                        'Ubah --primary dari "red" menjadi "#0ea5e9".'
                    ] 
                },
                validation: (code) => /--primary:\s*#0ea5e9/i.test(code),
                successMsg: { en: 'Variables fixed!', id: 'Variables diperbaiki!' }
            },
            // ========================================
            // LEVELS 13-90 REMOVED (TODO FOR NEXT AI)
            // ========================================
            {
                id: 13,
                chapter: 2,
                type: 'playground',
                title: { en: '13. Playground (Demo End)', id: '13. Playground (Demo Selesai)' },
                desc: { en: 'This is the end of the demo levels. You can now edit anything freely.', id: 'Ini adalah akhir level demo. Kamu sekarang bisa mengedit apapun dengan bebas.' },
                guidance: { 
                    en: [
                        'ðŸŽ‰ You completed the 12 Demo Levels!',
                        'ðŸš§ Levels 13-90 are under construction by Claude/Next AI.',
                        'ðŸŽ¨ Feel free to experiment with the code here!',
                        'ðŸ’¾ Save your work if you want to keep it.'
                    ], 
                    id: [
                        'ðŸŽ‰ Kamu menyelesaikan 12 Level Demo!',
                        'ðŸš§ Level 13-90 sedang dalam konstruksi oleh Claude/AI selanjutnya.',
                        'ðŸŽ¨ Bebas bereksperimen dengan kode di sini!',
                        'ðŸ’¾ Simpan karyamu jika ingin menyimpannya.'
                    ] 
                }
            }
        ];

        // --- INITIAL TEMPLATE ---
        const BASE_TEMPLATE = `<!DOCTYPE html>
<html>
<head>
  <style>
    /* Default CSS Academy Reset */
    body { font-family: sans-serif; padding: 0; margin: 0; background-color: #ffffff; color: #333; }
    
    /* === AREA CSS KAMU ADA DI BAWAH === */
  </style>
</head>
<body>

  <!-- STEP_1_CONTAINER -->

</body>
</html>`;

        function App() {
            const [lang, setLang] = useState(() => localStorage.getItem('css_academy_lang') || 'id');
            const [levelIdx, setLevelIdx] = useState(0);
            const [code, setCode] = useState(BASE_TEMPLATE);
            const [feedback, setFeedback] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [showChangelog, setShowChangelog] = useState(false);
            const fileInputRef = useRef(null);
            
            // Logic updated for contiguous array
            const level = LEVELS[levelIdx] || LEVELS[LEVELS.length - 1];

            useEffect(() => {
                localStorage.setItem('css_academy_lang', lang);
            }, [lang]);

            const iframeRef = useRef(null);
            useEffect(() => {
                if (iframeRef.current) iframeRef.current.srcdoc = code;
            }, [code]);

            const handleChoice = (opt) => {
                if (!opt.correct) {
                    setFeedback({ type: 'error', msg: opt.msg[lang] });
                    return;
                }
                let newCode = code.replace(level.targetMarker, opt.code);
                if (opt.cssToAdd) {
                    const styleEnd = newCode.indexOf('</style>');
                    if (styleEnd !== -1) {
                        newCode = newCode.slice(0, styleEnd) + opt.cssToAdd + newCode.slice(styleEnd);
                    }
                }
                setCode(newCode);
                setFeedback({ type: 'success', msg: opt.msg[lang] });
            };

            const handleEssayCheck = () => {
                if (level.validation && !level.validation(code)) {
                    setFeedback({ type: 'error', msg: lang === 'id' ? 'Coba ubah nilainya (jangan nilai default).' : 'Try changing default values.' });
                } else {
                    setFeedback({ type: 'success', msg: level.successMsg ? level.successMsg[lang] : 'Saved!' });
                }
            };

            const nextLevel = () => {
                setFeedback(null);
                if (levelIdx < LEVELS.length - 1) {
                    setLevelIdx(prev => prev + 1);
                }
            };

            const exportHTML = () => {
                const saveData = {
                    levelIdx: levelIdx,
                    lang: lang,
                    code: code
                };
                
                const saveComment = `\n<!-- NP_MOD_SAVE_DATA: ${JSON.stringify(saveData)} -->`;
                const codeWithSaveData = code + saveComment;
                
                const blob = new Blob([codeWithSaveData], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `css-academy-project-level-${levelIdx + 1}.html`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const loadHTML = () => {
                fileInputRef.current?.click();
            };

            const handleFileLoad = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileContent = e.target.result;
                    const saveDataRegex = /<!--\s*NP_MOD_SAVE_DATA:\s*({.*?})\s*-->/;
                    const match = fileContent.match(saveDataRegex);
                    
                    if (match && match[1]) {
                        try {
                            const saveData = JSON.parse(match[1]);
                            const codeWithoutSaveData = fileContent.replace(/\n?<!--\s*NP_MOD_SAVE_DATA:.*?-->\s*$/, '');
                            
                            // Check if saved level exists in current array, if not (e.g. was 50), reset to max or 0
                            let savedLevelIdx = saveData.levelIdx || 0;
                            if (savedLevelIdx >= LEVELS.length) {
                                savedLevelIdx = LEVELS.length - 1; // Default to last available
                            }

                            setLevelIdx(savedLevelIdx);
                            setLang(saveData.lang || 'id');
                            setCode(saveData.code || codeWithoutSaveData);
                            setFeedback({ 
                                type: 'success', 
                                msg: lang === 'id' 
                                    ? `Progress dimuat! Level ${savedLevelIdx + 1}` 
                                    : `Progress loaded! Level ${savedLevelIdx + 1}` 
                            });
                        } catch (err) {
                            setFeedback({ type: 'error', msg: lang === 'id' ? 'File tidak valid!' : 'Invalid file!' });
                        }
                    } else {
                        setCode(fileContent);
                        setFeedback({ type: 'success', msg: lang === 'id' ? 'HTML dimuat (tanpa save data)' : 'HTML loaded (no save data)' });
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            };

            const currentChapter = level.chapter || 1;
            const totalLevels = 90; // Keeping the "Target" as 90, but showing current progress

            return (
                <div className="flex flex-col h-full font-mono text-sm">
                    {/* HEADER */}
                    <header className="bg-slate-900 border-b border-slate-700 p-3 flex justify-between items-center text-white shrink-0 shadow-lg z-20">
                        <div className="flex items-center gap-3">
                            <div className="bg-cyan-500/10 p-2 rounded-lg border border-cyan-500/20">
                                <GraduationCapIcon className="text-cyan-400 w-5 h-5" />
                            </div>
                            <div className="flex flex-col">
                                <span className="font-bold tracking-tight text-slate-100 text-lg leading-none">CSS ACADEMY</span>
                                <span className="text-[10px] text-cyan-400 font-bold tracking-widest uppercase mt-1">Interactive Learning Environment</span>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center">
                            <div className="text-xs bg-slate-800 px-3 py-1.5 rounded-full text-slate-300 border border-slate-700 hidden md:block">
                                <span className="text-cyan-400 font-bold">Chapter {currentChapter}</span> â€¢ Level {levelIdx + 1}/{LEVELS.length} <span className="text-slate-500 text-[10px]">(Target: 90)</span>
                            </div>
                            
                            <button onClick={() => setShowChangelog(true)} className="flex items-center gap-1 bg-slate-800 hover:bg-slate-700 hover:text-cyan-400 px-3 py-1.5 rounded text-xs transition border border-slate-700">
                                <HistoryIcon /> <span className="hidden sm:inline">CHANGELOG</span>
                            </button>

                            <button onClick={() => setShowHelp(true)} className="flex items-center gap-1 bg-slate-800 hover:bg-slate-700 hover:text-cyan-400 px-3 py-1.5 rounded text-xs transition border border-slate-700" title={lang === 'id' ? 'Bantuan' : 'Help'}>
                                <HelpCircleIcon />
                            </button>
                            
                            <button onClick={() => setLang(l => l === 'en' ? 'id' : 'en')} className="flex items-center gap-1 bg-slate-800 hover:bg-slate-700 hover:text-cyan-400 px-3 py-1.5 rounded text-xs transition border border-slate-700 w-12 justify-center">
                                <GlobeIcon /> {lang.toUpperCase()}
                            </button>
                            
                            <div className="h-6 w-px bg-slate-700 mx-1"></div>

                            <button onClick={loadHTML} className="bg-slate-800 hover:bg-slate-700 text-cyan-400 border border-cyan-500/30 px-3 py-1.5 rounded text-xs font-bold flex items-center gap-1 transition">
                                <FolderOpenIcon /> <span className="hidden sm:inline">{lang === 'id' ? 'MUAT' : 'LOAD'}</span>
                            </button>
                            <button onClick={exportHTML} className="bg-cyan-600 hover:bg-cyan-500 text-white px-3 py-1.5 rounded text-xs font-bold flex items-center gap-1 transition shadow-lg shadow-cyan-900/20">
                                <SaveIcon /> <span className="hidden sm:inline">{lang === 'id' ? 'SIMPAN' : 'SAVE'}</span>
                            </button>
                        </div>
                        <input type="file" ref={fileInputRef} onChange={handleFileLoad} accept=".html" style={{ display: 'none' }} />
                    </header>

                    <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
                        {/* LEFT: EDITOR & INSTRUCTIONS */}
                        <div className="w-full md:w-1/2 flex flex-col border-r border-slate-700 bg-slate-950 h-1/2 md:h-full">
                            <div className="p-5 bg-slate-900 border-b border-slate-800 shadow-sm z-10">
                                <h2 className="text-cyan-400 font-bold mb-2 text-lg flex items-center gap-2 font-sans">
                                    <span className="bg-cyan-900/30 text-cyan-300 px-2 py-0.5 rounded text-xs border border-cyan-500/30">Lvl {levelIdx + 1}</span> 
                                    {level.title[lang]}
                                </h2>
                                <p className="text-slate-400 text-sm mb-3 leading-relaxed font-sans">{level.desc[lang]}</p>
                                
                                {(level.type === 'essay' || level.type === 'playground') && (
                                    <div className="mt-3 bg-slate-800/50 p-3 rounded-lg border border-slate-700 relative overflow-hidden group">
                                        <div className="absolute top-0 left-0 w-1 h-full bg-cyan-500"></div>
                                        <div className="text-[10px] text-cyan-400 uppercase font-bold mb-1.5 tracking-wider flex items-center gap-2">
                                            <span className="w-1.5 h-1.5 rounded-full bg-cyan-500 animate-pulse"></span>
                                            {lang === 'id' ? 'MISI HARI INI:' : 'TODAY\'S MISSION:'}
                                        </div>
                                        <ul className="list-disc list-inside text-xs text-slate-300 space-y-1.5 ml-1">
                                            {level.guidance[lang].map((g, i) => <li key={i}>{g}</li>)}
                                        </ul>
                                    </div>
                                )}
                            </div>

                            <div className="flex-1 relative group">
                                <div className="absolute top-2 right-4 text-[10px] text-slate-600 font-bold select-none pointer-events-none z-10">EDITOR</div>
                                <textarea 
                                    className="w-full h-full bg-slate-950 text-slate-300 p-5 resize-none focus:outline-none leading-relaxed selection:bg-cyan-900/50 selection:text-cyan-100 font-mono text-sm border-none"
                                    spellCheck="false"
                                    value={code}
                                    onChange={(e) => {
                                        setCode(e.target.value);
                                        if(feedback?.type === 'error') setFeedback(null);
                                    }}
                                />
                            </div>

                            <div className="p-4 bg-slate-900 border-t border-slate-800 min-h-[100px] flex flex-col justify-center shrink-0 relative">
                                {level.type === 'choice' && !feedback && (
                                    <div className="space-y-2">
                                        {level.options.map((opt, i) => (
                                            <button key={i} onClick={() => handleChoice(opt)} 
                                                className="w-full text-left px-4 py-3 bg-slate-800 border border-slate-700 hover:border-cyan-500 hover:bg-slate-750 hover:shadow-md hover:shadow-cyan-900/10 rounded-lg transition group flex items-start gap-3">
                                                <div className="bg-slate-700 text-cyan-400 font-bold w-6 h-6 rounded flex items-center justify-center text-xs shrink-0 group-hover:bg-cyan-500 group-hover:text-white transition">{String.fromCharCode(65 + i)}</div>
                                                <div className="flex-1">
                                                    <div className="text-slate-200 font-semibold text-sm mb-1 font-sans">{opt.label[lang].substring(3)}</div>
                                                    {opt.previewCode && (
                                                        <div className="text-[11px] font-mono text-cyan-300/70 bg-black/20 px-2 py-1 rounded inline-block border border-white/5">
                                                            {opt.previewCode}
                                                        </div>
                                                    )}
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                )}

                                {(level.type === 'essay' || level.type === 'playground') && !feedback && (
                                    <button onClick={handleEssayCheck} className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg flex justify-center items-center gap-2 transition hover:shadow-lg hover:shadow-cyan-500/20">
                                        <PlayIcon /> {lang === 'id' ? 'JALANKAN KODE' : 'RUN CODE'}
                                    </button>
                                )}

                                {feedback && (
                                    <div className={`p-4 rounded-lg border flex items-center gap-3 modal-animate ${feedback.type === 'success' ? 'bg-emerald-950/30 border-emerald-800/50' : 'bg-red-950/30 border-red-800/50'}`}>
                                        {feedback.type === 'success' ? <CheckCircleIcon className="text-emerald-400 shrink-0 w-6 h-6" /> : <TerminalIcon className="text-red-400 shrink-0 w-6 h-6" />}
                                        <div className="flex-1 text-sm">
                                            <div className={`font-bold ${feedback.type === 'success' ? 'text-emerald-400' : 'text-red-400'}`}>
                                                {feedback.type === 'success' ? (lang === 'id' ? 'BAGUS SEKALI!' : 'EXCELLENT!') : 'SYNTAX ERROR'}
                                            </div>
                                            <div className="text-slate-300 text-xs mt-0.5">{feedback.msg}</div>
                                        </div>
                                        {feedback.type === 'success' && levelIdx < LEVELS.length - 1 && (
                                            <button onClick={nextLevel} className="bg-emerald-600 hover:bg-emerald-500 text-white px-5 py-2 rounded-md text-xs font-bold shadow-lg shadow-emerald-900/20 whitespace-nowrap">
                                                NEXT LEVEL &gt;
                                            </button>
                                        )}
                                        {feedback.type === 'error' && (
                                            <button onClick={() => setFeedback(null)} className="text-slate-400 hover:text-white underline text-xs whitespace-nowrap">Try Again</button>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* RIGHT: LIVE PREVIEW */}
                        <div className="w-full md:w-1/2 bg-slate-100 flex flex-col h-1/2 md:h-full border-t md:border-t-0 md:border-l border-slate-700">
                            <div className="h-10 bg-slate-200 border-b border-slate-300 flex items-center px-4 gap-3 shrink-0">
                                <div className="flex gap-1.5">
                                    <div className="w-3 h-3 rounded-full bg-rose-400 border border-rose-500/50"></div>
                                    <div className="w-3 h-3 rounded-full bg-amber-400 border border-amber-500/50"></div>
                                    <div className="w-3 h-3 rounded-full bg-emerald-400 border border-emerald-500/50"></div>
                                </div>
                                <div className="text-[11px] text-slate-500 font-sans flex-1 bg-white border border-slate-300 rounded px-3 py-0.5 flex items-center shadow-sm">
                                    <span className="text-slate-300 mr-2">ðŸ”’</span> localhost:3000/css-academy/preview
                                </div>
                            </div>
                            <div className="flex-1 bg-checkered relative w-full h-full">
                                <iframe ref={iframeRef} title="preview" className="w-full h-full border-none" sandbox="allow-scripts" />
                            </div>
                        </div>
                    </div>

                    {/* CHANGELOG MODAL */}
                    {showChangelog && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 modal-animate" onClick={() => setShowChangelog(false)}>
                            <div className="bg-slate-900 border border-slate-700 rounded-xl max-w-lg w-full max-h-[80vh] overflow-hidden flex flex-col shadow-2xl shadow-cyan-900/20" onClick={(e) => e.stopPropagation()}>
                                <div className="p-5 border-b border-slate-800 flex justify-between items-center bg-slate-800/50">
                                    <h2 className="text-lg font-bold text-white flex items-center gap-2">
                                        <HistoryIcon className="text-cyan-400" /> Riwayat Perubahan
                                    </h2>
                                    <button onClick={() => setShowChangelog(false)} className="text-slate-400 hover:text-white text-xl">&times;</button>
                                </div>
                                <div className="p-6 overflow-y-auto space-y-6">
                                    {CHANGELOG.map((log, i) => (
                                        <div key={i} className="relative pl-6 border-l-2 border-slate-700 pb-2">
                                            <div className={`absolute -left-[9px] top-0 w-4 h-4 rounded-full border-2 ${i === 0 ? 'bg-cyan-500 border-cyan-900' : 'bg-slate-800 border-slate-600'}`}></div>
                                            <div className="flex justify-between items-start mb-2">
                                                <h3 className={`font-bold ${i === 0 ? 'text-cyan-400' : 'text-slate-300'}`}>{log.version}</h3>
                                                <span className="text-xs text-slate-500 font-mono">{log.date}</span>
                                            </div>
                                            <ul className="list-disc list-inside text-sm text-slate-400 space-y-1">
                                                {log.changes.map((change, idx) => (
                                                    <li key={idx}>{change}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    ))}
                                </div>
                                <div className="p-4 border-t border-slate-800 bg-slate-900 text-center">
                                    <p className="text-xs text-slate-600 font-mono">Build ID: CA-2026-V3</p>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* HELP MODAL */}
                    {showHelp && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 modal-animate" onClick={() => setShowHelp(false)}>
                            <div className="bg-slate-900 border border-slate-700 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6">
                                    <div className="flex items-center gap-3 mb-6 border-b border-slate-800 pb-4">
                                        <div className="bg-cyan-500/10 p-2 rounded-full">
                                            <HelpCircleIcon className="text-cyan-400 w-6 h-6" />
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold text-white">
                                                {lang === 'id' ? 'Pusat Bantuan' : 'Help Center'}
                                            </h2>
                                            <p className="text-xs text-slate-400">CSS Academy v3.0</p>
                                        </div>
                                    </div>
                                    
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-cyan-500/30 transition">
                                            <h3 className="text-cyan-300 font-bold mb-2 flex items-center gap-2 text-sm">
                                                <SaveIcon className="w-4 h-4" />
                                                {lang === 'id' ? 'Cara Menyimpan' : 'How to Save'}
                                            </h3>
                                            <p className="text-xs text-slate-400 leading-relaxed mb-2">
                                                {lang === 'id' 
                                                    ? 'Klik tombol SIMPAN untuk mengunduh file HTML yang berisi kode & progress kamu. File ini bisa dibuka kapan saja tanpa internet.' 
                                                    : 'Click SAVE to download an HTML file containing your code & progress. Open this file anytime offline.'}
                                            </p>
                                        </div>

                                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-cyan-500/30 transition">
                                            <h3 className="text-purple-300 font-bold mb-2 flex items-center gap-2 text-sm">
                                                <FolderOpenIcon className="w-4 h-4" />
                                                {lang === 'id' ? 'Cara Memuat' : 'How to Load'}
                                            </h3>
                                            <p className="text-xs text-slate-400 leading-relaxed mb-2">
                                                {lang === 'id' 
                                                    ? 'Punya file HTML yang disimpan sebelumnya? Klik MUAT dan pilih file tersebut untuk melanjutkan progress.' 
                                                    : 'Have a saved HTML file? Click LOAD and select it to restore your progress instantly.'}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="mt-6 bg-slate-800 p-4 rounded-lg">
                                        <h4 className="text-white font-bold text-sm mb-2">ðŸ’¡ Pro Tips</h4>
                                        <ul className="text-xs text-slate-400 space-y-2 list-disc list-inside">
                                            <li>Gunakan <strong>Chrome/Edge/Firefox</strong> terbaru untuk pengalaman terbaik.</li>
                                            <li>Jangan refresh halaman jika belum menyimpan (SIMPAN).</li>
                                            <li>Coba ubah nilai pixel atau warna di Editor untuk melihat efeknya secara langsung.</li>
                                        </ul>
                                    </div>

                                    <button onClick={() => setShowHelp(false)} className="mt-6 w-full bg-slate-100 hover:bg-white text-slate-900 font-bold py-3 rounded-lg transition shadow-lg">
                                        {lang === 'id' ? 'SAYA PAHAM' : 'UNDERSTOOD'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
